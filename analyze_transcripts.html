<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze Transcripts</title>
    <style>

        /* Speech & Excerpt Analysis Launcher (SEAL) - Analyze Transcripts Page */
        body {
            flex-direction: column;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to right, #f3e5f5, #e8eaf6); /* Soft, professional gradient */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .dashboard-container {
            background-color: #fff;
            border-radius: 12px;
            border: none;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); /* More pronounced shadow */
            padding: 60px;
            width: 80%; /* Make the dashboard-container take up 90% of the available width */
            max-width: none; /* Override max-width to allow full 90% width */
            min-width: 900px; /* Set a minimum width for the container */
            text-align: center;
        }

        .page-header {
            font-family: 'Montserrat', sans-serif; /* Modern, professional font */
            font-size: 1.5em;
            color: #37474f; /* Darker, more sophisticated color */
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle text shadow */
            display: flex;
            align-items: center;
        }

        .page-header span {
            color: #5c6bc0; /* Accent color */
        }

        /* Add more specific styles for the analyze transcripts page here */

        footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #777;
            opacity: 0.7;
        }

        .grey-box {
            background-color: #f0f0f0;
            border-radius: 12px; /* More rounded corners */
            padding: 20px;
            min-height: 600px;
            text-align: left;
            margin-top: 0px; /* Decrease margin-top */
            flex: 3; /* Occupies 30% of the space */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        }

        .smaller-box {
            background-color: #f0f0f0; /* Make the smaller box the same color as the grey box */
            border-radius: 12px; /* More rounded corners */
            padding: 20px;
            min-height: 600px;
            text-align: left;
            margin-left: 20px;
            flex: 7; /* Occupies 70% of the space */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05); /* Subtle shadow */
        }

        .smaller-box-header {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            color: #37474f;
            font-weight: 600;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            text-align: center;
            text-decoration: none; /* Remove default underline */
            border-bottom: 3px solid #5c6bc0; /* Add a colored border */
            padding-bottom: 5px; /* Adjust spacing */
            display: inline-block; /* Make the border only as wide as the text */
        }

        .smaller-box-header span {
            color: #5c6bc0;
        }

        .grey-box-header {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            color: #37474f;
            font-weight: 600;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            text-align: center;
            text-decoration: none; /* Remove default underline */
            border-bottom: 3px solid #5c6bc0; /* Add a colored border */
            padding-bottom: 5px; /* Adjust spacing */
            display: inline-block; /* Make the border only as wide as the text */
        }

        .grey-box{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: top;
        }

        .grey-box-header span {
            color: #5c6bc0;
        }

        .flex-container {
            display: flex;
            /* height: 90vh;  Make the container flex to take up 90% of the available screen space */
        }

        .transparent-box {
            background-color: transparent;
            border: 1px solid transparent;
            border-radius: 12px;
            height: calc(100% - 60px); /* Adjust height to fill remaining space */
            margin-top: 10px;
        }

        .grey-box form input[type="text"] {
            width: 90%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        .grey-box form button {
            background-color: #5c6bc0;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .grey-box form button:hover {
            background-color: #3f51b5;
        }

        .grey-box form select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            appearance: none; /* Remove default arrow */
            background-color: #fff;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%235c6bc0" height="12" width="12" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position-x: 95%;
            background-position-y: 50%;
            padding-right: 25px;
        }

        .grey-box form select:focus {
            outline: none;
            border-color: #5c6bc0;
        }

        /* New styles for transcript selection dropdown */
        .transcript-select {
            font-size: 1em;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-left: 20px;
            margin-right: 32px; /* Increased gap between dropdown and button */
            position: relative;
            top: 6px; /* Move dropdown down slightly for better alignment */
        }

        /* Responsive layout for header and controls */
    .header-controls-container {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-start;
        width: 100%;
        padding-left: 10%;
        position: relative;
        gap: 0;
    }

    .header-controls-container > * {
        margin-bottom: 8px;
    }

    @media (max-width: 1200px) {
        .header-controls-container {
            flex-direction: column;
            align-items: flex-start;
            padding-left: 5%;
            max-width: 100%;
            min-width: 0;
        }
        .page-header {
            margin-bottom: 10px;
        }
        #showFullTranscriptBtn {
            width: 100%;
            margin-top: 8px;
            margin-left: 0;
            height: auto;
        }
        .transcript-select {
            margin-right: 0;
        }
    }

    #showFullTranscriptBtn {
        background-color: #5c6bc0;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 10px 18px;
        font-size: 1em;
        cursor: pointer;
        white-space: nowrap;
        height: 40px;
        display: flex;
        align-items: center;
        margin: 0;
        /* Place button inline with select */
        position: relative;
        top: 6px; /* Move button down to align its bottom edge with header text */
    }

    .highlight {
            background-color: yellow;
            color: inherit;
        }
        body.darkmode .highlight {
            background-color: #3a5ca4;
            color: #fff;
        }

    /* Dark mode styles */
    body.darkmode {
        background: linear-gradient(to right, #23272f, #181a20);
        color: #e0e0e0;
    }
    body.darkmode .dashboard-container {
        background-color: #23272f;
        color: #e0e0e0;
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    body.darkmode .grey-box,
    body.darkmode .smaller-box {
        background-color: #23242a;
        color: #e0e0e0;
        box-shadow: 0 4px 8px rgba(0,0,0,0.18);
    }
    body.darkmode .grey-box-header,
    body.darkmode .smaller-box-header {
        color: #e0e0e0;
        border-bottom: 3px solid #8fa2f7;
    }
    body.darkmode .page-header {
        color: #e0e0e0;
    }
    body.darkmode .page-header span,
    body.darkmode .grey-box-header span,
    body.darkmode .smaller-box-header span {
        color: #8fa2f7;
    }
    body.darkmode .grey-box form input[type="text"],
    body.darkmode .grey-box form select {
        background-color: #23242a;
        color: #e0e0e0;
        border: 1px solid #444;
    }
    body.darkmode .grey-box form button,
    body.darkmode #showFullTranscriptBtn {
        background-color: #8fa2f7;
        color: #23242a;
    }
    body.darkmode .grey-box form button:hover,
    body.darkmode #showFullTranscriptBtn:hover {
        background-color: #5c6bc0;
        color: #fff;
    }
    body.darkmode .transparent-box {
        background-color: transparent;
        color: #e0e0e0;
    }
    body.darkmode footer {
        color: #aaa;
    }

    .checkbox-line {
    display: flex;
    align-items: flex-start;
    gap: 8px;
}
.copy-selected-btn {
    display: none;
    margin: 18px 0 0 0;
    padding: 10px 22px;
    background: #5c6bc0;
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    cursor: pointer;
    transition: background 0.2s;
}
.copy-selected-btn:hover {
    background: #3f51b5;
}
body.darkmode .copy-selected-btn {
    background: #8fa2f7;
    color: #23242a;
}
body.darkmode .copy-selected-btn:hover {
    background: #5c6bc0;
    color: #fff;
}
    </style>
</head>
<body>
    <div class="header-controls-container">
        <div class="page-header" style="display: flex; align-items: center;">
            <h1 class="page-header" style="margin-right: 24px;"><span>Analyze</span> Transcripts</h1>
            <!-- Transcript selection dropdown -->
            <select id="transcriptSelect" class="transcript-select">
                <option value="10-9/Transcript_001_23-40-00-RW-JH.srt">23-40-00-RW</option>
                <option value="10-9/Transcript_002_23-45-00-RW-JH.srt">23-45-00-JH</option>
                <option value="10-9/Transcript_003_23-50-00-RW-JH.srt">23-50-00-JH</option>
                <option value="10-9/Transcript_004_23-52-00-RW-JH.srt">23-52-00-RW</option>
                <option value="10-9/Transcript_005_00-00-00-RW-JH.srt">00-00-00-JH</option>
                <option value="10-9/Transcript_006_00-05-00-RW-JH.srt">00-05-00-RW</option>
                <option value="10-9/Transcript_007_00-30-00-VG-CK.srt">00-30-00-VG</option>
                <option value="10-9/Transcript_008_00-33-00-VG-CK.srt">00-33-00-VG</option>
                <option value="10-9/Transcript_009_00-40-00-VG-CK.srt">00-40-00-CK</option>
                <option value="10-9/Transcript_010_00-41-00-CG-CK.srt">00-41-00-CK</option>
                <option value="10-9/Transcript_011_00-45-00-VG-CK.srt">00-45-00-VG</option>
                <option value="10-9/Transcript_012_00-50-00-VG-CK.srt">00-50-00-CK</option>
                <option value="10-9/Transcript_013_01-05-00-VG-CK.srt">01-05-00-VG</option>
                <option value="10-9/Transcript_014_01-25-00-JH-RW.srt">01-25-00-JH</option>
                <option value="10-9/Transcript_015_01-45-00-JH-RW.srt">01-45-00-JH</option>
                <option value="10-9/Transcript_016_01-50-00-JH-RW.srt">01-50-00-RW</option>
                <option value="10-9/Transcript_017_02-00-00-JH-RW.srt">02-00-00-JH</option>
                <option value="10-9/Transcript_018_02-05-00-JH-RW.srt">02-05-00-JH</option>
                <option value="10-9/Transcript_019_02-10-00-JH-RW.srt">02-10-00-RW</option>
                <option value="catchall.srt">Catchall</option>
                <!-- Add more transcript files as needed -->
            </select>
        </div>
        <button id="showFullTranscriptBtn">
            Show Full Transcript (Highlight All Keywords)
        </button>
    </div>
    <h5>By Default - when a transcript is displayed, only lines with a keyword detected will be shown, click show full transcript to read the entire output, or click on a time to be brought to the occurrence of that utterance.</h3>
    <div class="dashboard-container">
        <div class="flex-container">
            <div class="grey-box" style="flex: 2;">
                <h2 class="grey-box-header"><span>Keyword</span> Selection:</h2>
                <form id="analysisForm">
                    <label for="keywords">Keywords (comma-separated):</label><br>
                    <input type="text" id="keywords" name="keywords"><br><br>
                    <button type="button" onclick="analyzeDocument()">Analyze</button>
					<br><br>
					<label for="keywordSelect">Choose a Keyword:</label>
					<select id="keywordSelect" name="keywordSelect" onchange="selectKeyword()" style="margin-top: 15px;">
    <option value="">Select a keyword</option>
    <option value="Whole Lunar Disc">Whole Lunar Disc</option>
    <option value="Earthrise">Earthrise</option>
    <option value="Sunrise">Sunrise</option>
    <option value="Sunset">Sunset</option>
    <option value="Earthset">Earthset</option>
    <option value="Dawn Terminator">Dawn Terminator</option>
    <option value="Dusk Terminator">Dusk Terminator</option>
    <option value="Impact Flashes">Impact Flashes</option>
    <option value="Western Limb">Western Limb</option>
    <option value="Eastern Limb">Eastern Limb</option>
    <option value="--Other PAO Space Event">--Other PAO Space Event</option>
    <option value="--Crew Reflection / View what you want">--Crew Reflection / View what you want</option>
    <option value="Aitken">Aitken</option>
    <option value="Necho Albedo Anomaly">Necho Albedo Anomaly</option>
    <option value="Anaxagoras">Anaxagoras</option>
    <option value="Antoniadi">Antoniadi</option>
    <option value="Apollo Basin">Apollo Basin</option>
    <option value="Apollo 11 Landing Site">Apollo 11 Landing Site</option>
    <option value="Apollo 12 Landing Site">Apollo 12 Landing Site</option>
    <option value="Apollo 16 Landing Site">Apollo 16 Landing Site</option>
    <option value="Apollo 17 Landing Site">Apollo 17 Landing Site</option>
    <option value="Aristarchus Plateau">Aristarchus Plateau</option>
    <option value="Atlas">Atlas</option>
    <option value="Billy">Billy</option>
    <option value="Bose and Bhabha Region">Bose and Bhabha Region</option>
    <option value="Buys-Ballot">Buys-Ballot</option>
    <option value="Byrgius A">Byrgius A</option>
    <option value="Campbell Volcanic Fill">Campbell Volcanic Fill</option>
    <option value="Catena Artamonov">Catena Artamonov</option>
    <option value="Catena Sylvester">Catena Sylvester</option>
    <option value="Chaplygin B">Chaplygin B</option>
    <option value="Clavius">Clavius</option>
    <option value="Cleomedes">Cleomedes</option>
    <option value="Compton">Compton</option>
    <option value="Compton-Belkovich Volcanic Region">Compton-Belkovich Volcanic Region</option>
    <option value="The Connecting Ridge">The Connecting Ridge</option>
    <option value="Copernicus">Copernicus</option>
    <option value="Mare Crisium">Mare Crisium</option>
    <option value="Crookes">Crookes</option>
    <option value="Crüger">Crüger</option>
    <option value="de Gerlache-Kocher Massif">de Gerlache-Kocher Massif</option>
    <option value="de Gerlache">de Gerlache</option>
    <option value="De La Rue">De La Rue</option>
    <option value="Deutsch">Deutsch</option>
    <option value="Denning-proximal Rayed">Denning-proximal Rayed</option>
    <option value="Dewar Region">Dewar Region</option>
    <option value="Sverdrup Rise Landing Region">Sverdrup Rise Landing Region</option>
    <option value="Dorsa Ewing">Dorsa Ewing</option>
    <option value="Dufay Albedo Anomaly">Dufay Albedo Anomaly</option>
    <option value="South Pole Region">South Pole Region</option>
    <option value="Euclides">Euclides</option>
    <option value="Flamsteed P">Flamsteed P</option>
    <option value="Gauss">Gauss</option>
    <option value="Giordano Bruno">Giordano Bruno</option>
    <option value="Glushko">Glushko</option>
    <option value="Goldschmidt">Goldschmidt</option>
    <option value="Grigg E">Grigg E</option>
    <option value="Grimaldi">Grimaldi</option>
    <option value="Gruithuisen Domes">Gruithuisen Domes</option>
    <option value="Fra Mauro">Fra Mauro</option>
    <option value="Hansteen">Hansteen</option>
    <option value="Haworth Region">Haworth Region</option>
    <option value="Herigonius Eta and Pi">Herigonius Eta and Pi</option>
    <option value="Hermite">Hermite</option>
    <option value="Mare Ingenii and Swirls">Mare Ingenii and Swirls</option>
    <option value="Ingenii">Ingenii</option>
    <option value="Impact">Impact</option>
    <option value="Isaev Volcanic Fill">Isaev Volcanic Fill</option>
    <option value="Flash">Flash</option>
    <option value="Jackson">Jackson</option>
    <option value="Distant Jackson Ray in SPA">Distant Jackson Ray in SPA</option>
    <option value="Jenner">Jenner</option>
    <option value="Jules Verne">Jules Verne</option>
    <option value="Kepler">Kepler</option>
    <option value="Kocher Region">Kocher Region</option>
    <option value="Kohlschütter Volcanic Fill">Kohlschütter Volcanic Fill</option>
    <option value="Kohlschütter V">Kohlschütter V</option>
    <option value="Korolev Basin">Korolev Basin</option>
    <option value="Koval'skiy Y">Koval'skiy Y</option>
    <option value="Kundt">Kundt</option>
    <option value="Lacus Luxuriae Region">Lacus Luxuriae Region</option>
    <option value="Larmor Q">Larmor Q</option>
    <option value="Lassell Massif">Lassell Massif</option>
    <option value="Mons Mouton">Mons Mouton</option>
    <option value="Leibnitz">Leibnitz</option>
    <option value="Lyot">Lyot</option>
    <option value="Mairan T Dome">Mairan T Dome</option>
    <option value="Mandel'shtam F">Mandel'shtam F</option>
    <option value="Mare Australe">Mare Australe</option>
    <option value="Mare Fecunditatis Wrinkle Ridges">Mare Fecunditatis Wrinkle Ridges</option>
    <option value="Mare Marginis">Mare Marginis</option>
    <option value="Marius Hills">Marius Hills</option>
    <option value="Mees Y">Mees Y</option>
    <option value="Mirzakhani">Mirzakhani</option>
    <option value="Mons Hansteen">Mons Hansteen</option>
    <option value="Mons Malapert">Mons Malapert</option>
    <option value="Montes Riphaues">Montes Riphaues</option>
    <option value="Montes Cordillera">Montes Cordillera</option>
    <option value="Montes Rook">Montes Rook</option>
    <option value="Moore F">Moore F</option>
    <option value="Moscoviense">Moscoviense</option>
    <option value="Mare Nectaris">Mare Nectaris</option>
    <option value="Neper">Neper</option>
    <option value="Nobile Region">Nobile Region</option>
    <option value="Chandler Dark Albedo Area">Chandler Dark Albedo Area</option>
    <option value="Idel'son L Rise Landing Region">Idel'son L Rise Landing Region</option>
    <option value="Oceanus Procellarum">Oceanus Procellarum</option>
    <option value="Ohm">Ohm</option>
    <option value="Oppenheimer">Oppenheimer Basin</option>
    <option value="Orientale">Orientale Basin</option>
    <option value="Paraskevopoulous Q">Paraskevopoulous Q</option>
    <option value="Peary">Peary</option>
    <option value="Pierazzo">Pierazzo</option>
    <option value="Plato">Plato</option>
    <option value="Poincaré Region">Poincaré Region</option>
    <option value="Proclus">Proclus</option>
    <option value="Pythagoras">Pythagoras</option>
    <option value="Rayet Y">Rayet Y</option>
    <option value="Reiner Gamma">Reiner Gamma</option>
    <option value="Rimae Sirsalis">Rimae Sirsalis</option>
    <option value="Rozhdestvenskiy">Rozhdestvenskiy</option>
    <option value="Rupes Atlai">Rupes Atlai</option>
    <option value="Rupes Recta">Rupes Recta</option>
    <option value="Ryder">Ryder</option>
    <option value="Schiller-Schikard Region">Schiller-Schikard Region</option>
    <option value="Schmidt">Schmidt</option>
    <option value="Schrödinger Basin">Schrödinger Basin</option>
    <option value="Sinus Aestueem Dark Spots">Sinus Aestueem Dark Spots</option>
    <option value="South Pole Aitken Basin">South Pole Aitken Basin</option>
    <option value="Sulpicius Gallus">Sulpicius Gallus</option>
    <option value="Seleucus">Seleucus</option>
    <option value="Slater Plain Artemis Region">Slater Plain Artemis Region</option>
    <option value="Stefan L">Stefan L</option>
    <option value="Sundman J">Sundman J</option>
    <option value="Sundman V">Sundman V</option>
    <option value="Thales">Thales</option>
    <option value="Tharp">Tharp</option>
    <option value="Orientale Annular Ring">Orientale Annular Ring</option>
    <option value="Tsiolkovskiy">Tsiolkovskiy</option>
    <option value="Terminator">Terminator</option>
    <option value="Tycho">Tycho</option>
    <option value="NW Orientale Rayed">NW Orientale Rayed</option>
    <option value="Atlas Region Rayed">Atlas Region Rayed</option>
    <option value="Vavilov">Vavilov</option>
    <option value="Virtanen">Virtanen</option>
    <option value="Tranquilitatis and Serenitatis Region">Tranquilitatis and Serenitatis Region</option>
    <option value="Whipple">Whipple</option>
    <option value="Wichmann R">Wichmann R</option>
    <option value="Zucchius">Zucchius</option>
    <option value="Racah X Scarp">Racah X Scarp</option>
    <option value="Mare Humorum">Mare Humorum</option>
    <option value="Humorum-Vitello Fault Complex">Humorum-Vitello Fault Complex</option>
</select>
                </form>
                <!-- Text will go here -->
            </div>
            <div class="smaller-box">
                <h2 class="smaller-box-header"><span>Transcript</span> Findings:</h2>
                <div class="transparent-box" id="results">
                    <!-- Transparent box content -->
                </div>
                <button id="copySelectedBtn" class="copy-selected-btn">Copy Selected Lines</button>
            </div>
        </div>
        <footer>
            A2 Summer 2025 by @jaredr
        </footer>
    </div>
    <!-- Back to Top Button -->
    <button id="backToTopBtn" title="Back to Top" style="
        position: fixed;
        left: 32px;
        bottom: 32px;
        z-index: 1000;
        background: #5c6bc0;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        font-size: 1.7em;
        box-shadow: 0 2px 8px rgba(0,0,0,0.18);
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        transition: background 0.2s, opacity 0.2s;
    ">&uarr;</button>
    <script>
        const minWidth = 900; // Minimum width corresponding to dashboard_container's min-width

        window.addEventListener('resize', function() {
            if (window.innerWidth < minWidth) {
                document.body.style.width = minWidth + 'px';
            } else {
                document.body.style.width = 'auto';
            }
        });

        // Initial check on page load
        if (window.innerWidth < minWidth) {
            document.body.style.width = minWidth + 'px';
        }

        function getSelectedTranscriptFile() {
            const select = document.getElementById('transcriptSelect');
            return select ? select.value : 'recording.srt';
        }

        // Helper: Map transcript file names to display names
        const transcriptDisplayNames = {
            "10-9/Transcript_001_23-40-00-RW-JH.srt": "23-40-00-RW",
            "10-9/Transcript_002_23-45-00-RW-JH.srt": "23-45-00-JH",
            "10-9/Transcript_003_23-50-00-RW-JH.srt": "23-50-00-JH",
            "10-9/Transcript_004_23-52-00-RW-JH.srt": "23-52-00-RW",
            "10-9/Transcript_005_00-00-00-RW-JH.srt": "00-00-00-JH",
            "10-9/Transcript_006_00-05-00-RW-JH.srt": "00-05-00-RW",
            "10-9/Transcript_007_00-30-00-VG-CK.srt": "00-30-00-VG",
            "10-9/Transcript_008_00-33-00-VG-CK.srt": "00-33-00-VG",
            "10-9/Transcript_009_00-40-00-VG-CK.srt": "00-40-00-CK",
            "10-9/Transcript_010_00-41-00-CG-CK.srt": "00-41-00-CK",
            "10-9/Transcript_011_00-45-00-VG-CK.srt": "00-45-00-VG",
            "10-9/Transcript_012_00-50-00-VG-CK.srt": "00-50-00-CK",
            "10-9/Transcript_013_01-05-00-VG-CK.srt": "01-05-00-VG",
            "10-9/Transcript_014_01-25-00-JH-RW.srt": "01-25-00-JH",
            "10-9/Transcript_015_01-45-00-JH-RW.srt": "01-45-00-JH",
            "10-9/Transcript_016_01-50-00-JH-RW.srt": "01-50-00-RW",
            "10-9/Transcript_017_02-00-00-JH-RW.srt": "02-00-00-JH",
            "10-9/Transcript_018_02-05-00-JH-RW.srt": "02-05-00-JH",
            "10-9/Transcript_019_02-10-00-JH-RW.srt": "02-10-00-RW",
            "catchall.srt": "Catchall"
        };

        // Helper: Map transcript section numbers to display names
        const sectionNumberToDisplay = {
            "001": "23-40-00-RW",
            "002": "23-45-00-JH",
            "003": "23-50-00-JH",
            "004": "23-52-00-RW",
            "005": "00-00-00-JH",
            "006": "00-05-00-RW",
            "007": "00-30-00-VG",
            "008": "00-33-00-VG",
            "009": "00-40-00-CK",
            "010": "00-41-00-CK",
            "011": "00-45-00-VG",
            "012": "00-50-00-CK",
            "013": "01-05-00-VG",
            "014": "01-25-00-JH",
            "015": "01-45-00-JH",
            "016": "01-50-00-RW",
            "017": "02-00-00-JH",
            "018": "02-05-00-JH",
            "019": "02-10-00-RW"
        };

        // Enhanced SRT parser for catchall: detects section headers and assigns section to each entry
        function parseSRT(srtText, isCatchall = false) {
            if (!isCatchall) {
                const entries = [];
                const lines = srtText.split(/\r\n|\n|\r/);
                let i = 0;
                while (i < lines.length) {
                    const index = parseInt(lines[i++]);
                    if (isNaN(index)) continue;
                    const time = lines[i++];
                    let text = '';
                    while (i < lines.length && lines[i] !== '') {
                        text += lines[i++] + '<br>';
                    }
                    text = text.trim();
                    i++;
                    entries.push({ index, time, text });
                }
                return entries;
            } else {
                // Catchall: parse sections
                const entries = [];
                const lines = srtText.split(/\r\n|\n|\r/);
                let i = 0;
                let currentSection = null;
                let currentSectionRaw = null;
                while (i < lines.length) {
                    // Detect section header, e.g., "### Transcript 001"
                    const sectionMatch = lines[i].match(/^#+\s*Transcript\s+(\d+)/i);
                    if (sectionMatch) {
                        currentSection = sectionMatch[1];
                        currentSectionRaw = lines[i];
                        i++;
                        continue;
                    }
                    const index = parseInt(lines[i]);
                    if (isNaN(index)) { i++; continue; }
                    i++;
                    const time = lines[i++];
                    let text = '';
                    while (i < lines.length && lines[i] !== '') {
                        text += lines[i++] + '<br>';
                    }
                    text = text.trim();
                    i++;
                    entries.push({
                        index,
                        time,
                        text,
                        section: currentSection,
                        sectionRaw: currentSectionRaw
                    });
                }
                return entries;
            }
        }

        // Helper: Generate a unique line id for catchall or normal transcripts
function getLineId(entry, isCatchall) {
    if (isCatchall && entry.section) {
        // Pad section to 3 digits for consistency
        const section = entry.section.toString().padStart(3, '0');
        return `transcript-line-${section}-${entry.index}`;
    } else {
        return `transcript-line-${entry.index}`;
    }
}

        function analyzeDocument() {
            const keywordsInput = document.getElementById('keywords').value;
            const keywords = keywordsInput.split(',').map(keyword => keyword.trim().toLowerCase()).filter(Boolean);
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Clear previous results

            if (keywords.length === 0) {
                resultsDiv.innerText = 'Please enter at least one keyword.';
                document.getElementById('copySelectedBtn').style.display = 'none';
                return;
            }

            const transcriptFile = getSelectedTranscriptFile();
            const isCatchall = transcriptFile === "catchall.srt";

            fetch(transcriptFile)
                .then(response => response.text())
                .then(srtText => {
                    const entries = parseSRT(srtText, isCatchall);

                    const matchingEntries = entries.filter(entry =>
                        keywords.some(keyword => {
                            if (keyword === 'i') {
                                // Match 'i' only as a standalone word
                                const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                                return entry.text.toLowerCase().match(regex);
                            } else {
                                return entry.text.toLowerCase().includes(keyword);
                            }
                        })
                    );

                    // Display results
                    if (matchingEntries.length > 0) {
                        renderTranscriptWithCheckboxes(matchingEntries, keywords, isCatchall);
                    } else {
                        resultsDiv.innerText = 'No matching entries found.';
                        document.getElementById('copySelectedBtn').style.display = 'none';
                    }
                })
                .catch(error => {
                    resultsDiv.innerText = 'Error reading file: ' + error;
                    document.getElementById('copySelectedBtn').style.display = 'none';
                });
        }

		document.getElementById('keywords').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent form submission
                analyzeDocument();
            }
        });

		function selectKeyword() {
			const selectedKeyword = document.getElementById('keywordSelect').value;
			if (selectedKeyword) {
				document.getElementById('keywords').value = selectedKeyword;
				analyzeDocument();
			}
		}

        // Re-analyze when transcript selection changes
        document.getElementById('transcriptSelect').addEventListener('change', function() {
            // Get all keyword options except the empty one
            const keywordSelect = document.getElementById('keywordSelect');
            const allKeywords = Array.from(keywordSelect.options)
                .map(opt => opt.value)
                .filter(val => val && val !== "");
            // Do not display in input, but analyze for all keywords
            document.getElementById('keywords').value = '';
            analyzeDocumentWithKeywords(allKeywords);
        });

        // Helper to analyze with a provided keyword array (does not touch input box)
        function analyzeDocumentWithKeywords(keywordsArray) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Clear previous results

            const transcriptFile = getSelectedTranscriptFile();
            const isCatchall = transcriptFile === "catchall.srt";

            fetch(transcriptFile)
                .then(response => response.text())
                .then(srtText => {
                    const entries = parseSRT(srtText, isCatchall);

                    const matchingEntries = entries.filter(entry =>
                        keywordsArray.some(keyword => {
                            if (keyword.toLowerCase() === 'i') {
                                const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                                return entry.text.toLowerCase().match(regex);
                            } else {
                                return entry.text.toLowerCase().includes(keyword.toLowerCase());
                            }
                        })
                    );

                    if (matchingEntries.length > 0) {
                        renderTranscriptWithCheckboxes(matchingEntries, keywordsArray, isCatchall);
                    } else {
                        // No matches: show full transcript
                        renderTranscriptWithCheckboxes(entries, keywordsArray, isCatchall);
                    }
                })
                .catch(error => {
                    resultsDiv.innerText = 'Error reading file: ' + error;
                    document.getElementById('copySelectedBtn').style.display = 'none';
                });
        }

        // Helper to show full transcript and scroll to a specific line
        function showFullTranscriptAndScrollTo(targetIndex, targetSection) {
            let transcriptFile = getSelectedTranscriptFile();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Loading...';

            // If we're currently viewing catchall and have a target section, switch to that specific audio file
            if (transcriptFile === "catchall.srt" && targetSection) {
                const sectionPadded = targetSection.toString().padStart(3, '0');
                transcriptFile = `Transcript_${sectionPadded}_corrected.srt`;
                
                // Find the exact filename from our mapping
                const transcriptFiles = {
                    "001": "10-9/Transcript_001_23-40-00-RW-JH.srt",
                    "002": "10-9/Transcript_002_23-45-00-RW-JH.srt",
                    "003": "10-9/Transcript_003_23-50-00-RW-JH.srt",
                    "004": "10-9/Transcript_004_23-52-00-RW-JH.srt",
                    "005": "10-9/Transcript_005_00-00-00-RW-JH.srt",
                    "006": "10-9/Transcript_006_00-05-00-RW-JH.srt",
                    "007": "10-9/Transcript_007_00-30-00-VG-CK.srt",
                    "008": "10-9/Transcript_008_00-33-00-VG-CK.srt",
                    "009": "10-9/Transcript_009_00-40-00-VG-CK.srt",
                    "010": "10-9/Transcript_010_00-41-00-CG-CK.srt",
                    "011": "10-9/Transcript_011_00-45-00-VG-CK.srt",
                    "012": "10-9/Transcript_012_00-50-00-VG-CK.srt",
                    "013": "10-9/Transcript_013_01-05-00-VG-CK.srt",
                    "014": "10-9/Transcript_014_01-25-00-JH-RW.srt",
                    "015": "10-9/Transcript_015_01-45-00-JH-RW.srt",
                    "016": "10-9/Transcript_016_01-50-00-JH-RW.srt",
                    "017": "10-9/Transcript_017_02-00-00-JH-RW.srt",
                    "018": "10-9/Transcript_018_02-05-00-JH-RW.srt",
                    "019": "10-9/Transcript_019_02-10-00-JH-RW.srt"
                };
                
                if (transcriptFiles[sectionPadded]) {
                    transcriptFile = transcriptFiles[sectionPadded];
                    // Update the dropdown to reflect the new selection
                    const transcriptSelect = document.getElementById('transcriptSelect');
                    transcriptSelect.value = transcriptFile;
                }
            }

            // Get all keywords from dropdown (excluding empty)
            const keywordSelect = document.getElementById('keywordSelect');
            const allKeywords = Array.from(keywordSelect.options)
                .map(opt => opt.value)
                .filter(val => val && val !== "");

            // Get keywords from the input box (if any)
            const keywordsInput = document.getElementById('keywords').value;
            let searchKeywords = keywordsInput
                .split(',')
                .map(k => k.trim())
                .filter(Boolean);

            // If no keywords in input, use all dropdown keywords (for full transcript mode)
            if (searchKeywords.length === 0) {
                searchKeywords = allKeywords;
            }

            const isCatchall = transcriptFile === "catchall.srt";

            fetch(transcriptFile)
                .then(response => response.text())
                .then(srtText => {
                    const entries = parseSRT(srtText, isCatchall);
                    renderTranscriptWithCheckboxes(entries, searchKeywords, isCatchall);

                    // Scroll to the target line after rendering
                    setTimeout(() => {
                        let targetElem;
                        // If we switched from catchall to individual transcript, use simple line ID
                        if (getSelectedTranscriptFile() === "catchall.srt" && targetSection) {
                            // Still in catchall mode
                            const section = targetSection.toString().padStart(3, '0');
                            targetElem = document.getElementById(`transcript-line-${section}-${targetIndex}`);
                        } else {
                            // Individual transcript mode (including when we switched from catchall)
                            targetElem = document.getElementById('transcript-line-' + targetIndex);
                        }
                        if (targetElem) {
                            targetElem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            // Flash green in light mode, blue in dark mode
                            if (document.body.classList.contains('darkmode')) {
                                targetElem.style.background = '#3a5ca4';
                                targetElem.style.color = '#fff';
                            } else {
                                targetElem.style.background = '#b6e7c9';
                                targetElem.style.color = '';
                            }
                            setTimeout(() => {
                                targetElem.style.background = '';
                                targetElem.style.color = '';
                            }, 1500);
                        }
                    }, 50);
                })
                .catch(error => {
                    resultsDiv.innerText = 'Error reading file: ' + error;
                    document.getElementById('copySelectedBtn').style.display = 'none';
                });
        }

        document.getElementById('showFullTranscriptBtn').addEventListener('click', function() {
            const transcriptFile = getSelectedTranscriptFile();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = 'Loading...';

            // Get all keywords from dropdown (excluding empty)
            const keywordSelect = document.getElementById('keywordSelect');
            const allKeywords = Array.from(keywordSelect.options)
                .map(opt => opt.value)
                .filter(val => val && val !== "");

            const isCatchall = transcriptFile === "catchall.srt";

            fetch(transcriptFile)
                .then(response => response.text())
                .then(srtText => {
                    const entries = parseSRT(srtText, isCatchall);
                    renderTranscriptWithCheckboxes(entries, allKeywords, isCatchall);
                })
                .catch(error => {
                    resultsDiv.innerText = 'Error reading file: ' + error;
                    document.getElementById('copySelectedBtn').style.display = 'none';
                });
        });

        // Modified: renderTranscriptWithCheckboxes now supports catchall section display
        function renderTranscriptWithCheckboxes(entries, highlightKeywords = [], isCatchall = false) {
            const resultsDiv = document.getElementById('results');
            let resultsHTML = '<ol style="font-family: inherit;">';
            entries.forEach(entry => {
                let highlightedText = entry.text;
                highlightKeywords.forEach(keyword => {
                    if (!keyword) return;
                    if (keyword.toLowerCase() === 'i') {
                        const regex = new RegExp(`\\b${keyword}\\b`, 'gi');
                        highlightedText = highlightedText.replace(regex, '<span class="highlight">$&</span>');
                    } else {
                        const regex = new RegExp(keyword, 'gi');
                        highlightedText = highlightedText.replace(regex, '<span class="highlight">$&</span>');
                    }
                });
                // Section label for catchall
                let sectionLabel = '';
                if (isCatchall && entry.section) {
                    const display = sectionNumberToDisplay[entry.section] || `Transcript ${entry.section}`;
                    sectionLabel = `<span style="color:#aaa;font-size:0.95em;margin-left:12px;">${display}</span>`;
                }
                const lineId = getLineId(entry, isCatchall);
                resultsHTML += `
                <li id="${lineId}">
                    <div class="checkbox-line">
                        <input type="checkbox" class="line-checkbox" data-line-index="${entry.index}" data-section="${isCatchall && entry.section ? entry.section : ''}">
                        <div>
                            <strong>
                                <a href="#" class="jump-to-line" data-line-index="${entry.index}" data-section="${isCatchall && entry.section ? entry.section : ''}" style="color:#5c6bc0;text-decoration:underline;cursor:pointer;">
                                    ${entry.time}
                                </a>
                            </strong>
                            ${sectionLabel}<br>${highlightedText}
                        </div>
                    </div>
                </li>`;
            });
            resultsHTML += '</ol>';
            resultsDiv.innerHTML = resultsHTML;
            setupCheckboxSelection();

            // Add click listeners to each timestamp link
            document.querySelectorAll('.jump-to-line').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const lineIndex = this.getAttribute('data-line-index');
                    const section = this.getAttribute('data-section');
                    showFullTranscriptAndScrollTo(lineIndex, section);
                });
            });
        }

        // Setup checkbox selection logic (shift-select, show/hide copy button)
function setupCheckboxSelection() {
    const checkboxes = Array.from(document.querySelectorAll('.line-checkbox'));
    const copyBtn = document.getElementById('copySelectedBtn');
    let lastChecked = null;

    checkboxes.forEach(cb => {
        cb.addEventListener('click', function(e) {
            if (e.shiftKey && lastChecked) {
                // Always select all checkboxes between lastChecked and this, inclusive
                const start = checkboxes.indexOf(lastChecked);
                const end = checkboxes.indexOf(this);
                const [min, max] = [start, end].sort((a, b) => a - b);
                checkboxes.forEach((box, idx) => {
                    box.checked = (idx >= min && idx <= max);
                });
            } else {
                // If not shift, check if two or more boxes are checked, and select all in between
                const checkedIndexes = checkboxes
                    .map((box, idx) => box.checked ? idx : -1)
                    .filter(idx => idx !== -1);
                if (checkedIndexes.length > 1) {
                    const [min, max] = [Math.min(...checkedIndexes), Math.max(...checkedIndexes)];
                    checkboxes.forEach((box, idx) => {
                        box.checked = (idx >= min && idx <= max);
                    });
                }
            }
            lastChecked = this;
            updateCopyButtonVisibility();
        });
        cb.addEventListener('change', function() {
            // Also check for non-shift multi-selects
            const checkedIndexes = checkboxes
                .map((box, idx) => box.checked ? idx : -1)
                .filter(idx => idx !== -1);
            if (checkedIndexes.length > 1) {
                const [min, max] = [Math.min(...checkedIndexes), Math.max(...checkedIndexes)];
                checkboxes.forEach((box, idx) => {
                    box.checked = (idx >= min && idx <= max);
                });
            }
            updateCopyButtonVisibility();
        });
    });

    function updateCopyButtonVisibility() {
        const anyChecked = checkboxes.some(cb => cb.checked);
        copyBtn.style.display = anyChecked ? 'block' : 'none';
    }
}

// Copy selected lines to clipboard (plain text, no HTML tags)
document.getElementById('copySelectedBtn').addEventListener('click', function() {
    const checkboxes = Array.from(document.querySelectorAll('.line-checkbox'));
    const selectedLis = checkboxes.filter(cb => cb.checked)
        .map(cb => cb.closest('li'));
    if (selectedLis.length === 0) return;

    let lines = [];
    if (selectedLis.length === 1) {
        // Only one line selected: include timestamp and text
        const div = selectedLis[0].querySelector('.checkbox-line > div');
        const strong = div.querySelector('strong');
        const timestamp = strong ? strong.innerText.trim() : '';
        // Remove the <strong> (timestamp) from the HTML for text extraction
        let html = div.innerHTML.replace(/<strong>[\s\S]*?<\/strong>\s*<br\s*\/?>/i, '');
        html = html.replace(/<span[^>]*>|<\/span>/g, '').replace(/<br\s*\/?>/gi, '\n');
        html = html.replace(/<[^>]+>/g, '');
        lines = [(timestamp ? `[${timestamp}]\n` : '') + html.trim()];
    } else {
        // Multiple lines: first and last with timestamp, middle without
        const getText = div => {
            // Remove the <strong> (timestamp) from the HTML for text extraction
            let html = div.innerHTML.replace(/<strong>[\s\S]*?<\/strong>\s*<br\s*\/?>/i, '');
            html = html.replace(/<span[^>]*>|<\/span>/g, '').replace(/<br\s*\/?>/gi, '\n');
            html = html.replace(/<[^>]+>/g, '');
            return html.trim();
        };
        // First line
        const firstDiv = selectedLis[0].querySelector('.checkbox-line > div');
        const firstStrong = firstDiv.querySelector('strong');
        const firstTimestamp = firstStrong ? firstStrong.innerText.trim() : '';
        lines.push((firstTimestamp ? `[${firstTimestamp}]\n` : '') + getText(firstDiv));
        // Middle lines (no timestamp)
        for (let i = 1; i < selectedLis.length - 1; i++) {
            const div = selectedLis[i].querySelector('.checkbox-line > div');
            lines.push(getText(div));
        }
        // Last line (if more than one)
        if (selectedLis.length > 1) {
            const lastDiv = selectedLis[selectedLis.length - 1].querySelector('.checkbox-line > div');
            const lastStrong = lastDiv.querySelector('strong');
            const lastTimestamp = lastStrong ? lastStrong.innerText.trim() : '';
            lines.push((lastTimestamp ? `[${lastTimestamp}]\n` : '') + getText(lastDiv));
        }
    }
    const text = lines.join('\n\n');
    // Use a fallback for clipboard if navigator.clipboard fails
    function fallbackCopy(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
        } catch (err) {}
        document.body.removeChild(textarea);
    }
    function uncheckAll() {
        checkboxes.forEach(cb => { cb.checked = false; });
        document.getElementById('copySelectedBtn').style.display = 'none';
    }
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
            document.getElementById('copySelectedBtn').innerText = 'Copied!';
            setTimeout(() => {
                document.getElementById('copySelectedBtn').innerText = 'Copy Selected Lines';
                uncheckAll();
            }, 1200);
        }).catch(() => {
            fallbackCopy(text);
            document.getElementById('copySelectedBtn').innerText = 'Copied!';
            setTimeout(() => {
                document.getElementById('copySelectedBtn').innerText = 'Copy Selected Lines';
                uncheckAll();
            }, 1200);
        });
    } else {
        fallbackCopy(text);
        document.getElementById('copySelectedBtn').innerText = 'Copied!';
        setTimeout(() => {
            document.getElementById('copySelectedBtn').innerText = 'Copy Selected Lines';
            uncheckAll();
        }, 1200);
    }
});

    </script>
    <!-- Dark mode toggle checkbox below main container -->
    <div style="width: 100%; display: flex; justify-content: flex-end; align-items: center; margin-top: 18px; padding-right: 8vw;">
        <label for="darkModeToggle" style="margin-right: 10px; font-size: 1em; color: #777; display: flex; align-items: center;">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="#888" style="margin-right: 6px; vertical-align: middle;">
                <path d="M13.61 2.05a8 8 0 1 0 4.34 11.41.75.75 0 0 0-.82-1.09A6.5 6.5 0 0 1 8.63 3.07a.75.75 0 0 0-1.09-.82z"/>
            </svg>
            Dark Mode
        </label>
        <input type="checkbox" id="darkModeToggle" style="width: 22px; height: 22px; accent-color: #5c6bc0; cursor: pointer;">
    </div>
    <script>
    // Dark mode toggle logic for checkbox
    const darkModeToggle = document.getElementById('darkModeToggle');
    function setDarkModeCheckbox(val) {
        if (val) {
            document.body.classList.add('darkmode');
        } else {
            document.body.classList.remove('darkmode');
        }
    }
    darkModeToggle.addEventListener('change', function() {
        setDarkModeCheckbox(this.checked);
        localStorage.setItem('darkmode', this.checked ? 'true' : 'false');
    });

    // Optional: persist dark mode preference
    if (localStorage.getItem('darkmode') === 'true') {
        darkModeToggle.checked = true;
        document.body.classList.add('darkmode');
    } else {
        darkModeToggle.checked = false;
        document.body.classList.remove('darkmode');
    }
    </script>
    <!-- Back to Top Button logic -->
    <script>
    // Back to Top Button logic
    const backToTopBtn = document.getElementById('backToTopBtn');
    window.addEventListener('scroll', function() {
        if (window.scrollY > 120) {
            backToTopBtn.style.display = 'flex';
            backToTopBtn.style.opacity = '1';
        } else {
            backToTopBtn.style.opacity = '0';
            setTimeout(() => {
                if (window.scrollY <= 120) backToTopBtn.style.display = 'none';
            }, 200);
        }
    });
    backToTopBtn.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    </script>
</body>
</html>
